
plugins {
   // id "org.sonarqube" version "2.4"
    id 'war'
    id 'io.spring.dependency-management' version '1.0.1.RELEASE'

}

apply plugin: 'java'
apply plugin: "jacoco"
//apply plugin:  "application"

sourceCompatibility = 1.8
targetCompatibility = '1.8'
version = '1.2.1'




/*
 * Gets the version name from the latest Git tag
 */
def getVersionName = { ->
    def stdout = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'describe', '--tags', '--always'
        standardOutput = stdout
    }
    return stdout.toString().trim()
}


allprojects {
    version = getVersionName()
    group = 'com.bearingpoint.devops'


    task wrapper(type: Wrapper) {
        gradleVersion = '3.4.1'
    }
}


configurations {
    provided
}

dependencyManagement {
    imports {
        mavenBom 'org.apache.logging.log4j:log4j-bom:2.11.1'
    }
}


dependencies {

    // https://mvnrepository.com/artifact/javax.inject/javax.inject
    compile group: 'javax.inject', name: 'javax.inject', version: '1'

    //compile group: 'org.java-websocket', name: 'Java-WebSocket', version: '1.3.0'

    //api 'org.apache.commons:commons-math3:3.6.1'
    // https://mvnrepository.com/artifact/org.java-websocket/Java-WebSocket

    // https://mvnrepository.com/artifact/javax.enterprise/cdi-api

    compile group: 'org.apache.logging.log4j', name: 'log4j-web', version: '2.11.1'
    compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.11.1'
    compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.11.1'




    // https://mvnrepository.com/artifact/com.fasterxml.jackson.jaxrs/jackson-jaxrs-json-provider

    // https://mvnrepository.com/artifact/org.glassfish.main.common/glassfish-api
    //compile group: 'org.glassfish.main.common', name: 'glassfish-api', version: '5.0'

    // https://mvnrepository.com/artifact/org.glassfish/javax.json
    compile group: 'javax.json', name: 'javax.json-api', version: '1.1.4'
    provided group: 'org.glassfish', name: 'javax.json', version: '1.1.4'

    compile group: 'com.fasterxml.jackson.jaxrs', name: 'jackson-jaxrs-json-provider', version: '2.9.7'

    compile group: 'javax.enterprise', name: 'cdi-api', version: '2.0'
    compile group: 'javax.websocket', name: 'javax.websocket-api', version: '1.1'



    //implementation 'com.google.guava:guava:23.0'

    //testImplementation 'junit:junit:4.12'
}

repositories {
    mavenCentral()
    jcenter()

}

//task run(dependsOn: 'war', type:Exec) {
//    workingDir "/opt/glassfish5/glassfish/bin"
//    commandline "java"
//    args "-version"
//
//}

task echo{
    println "echo "
}


task run(dependsOn: 'war', type:Exec) {
   // workingDir "${glassfishHome${File.separator}bin"
    workingDir "/opt/glassfish5/glassfish/bin"

  //  if (System.properties['os.name'].toLowerCase().contains('windows')) {
  //      commandLine 'cmd', '/c', 'asadmin.bat'
  //  } else {
    commandLine "./asadmin"
   // }
    //args "echo" ${war.archivePath}
    // ~/wk-devops/SonoffWebSockets/build/libs $ asadmin deploy --force=true SonoffWebSockets-722e26d.war
    args "deploy", "--force=true", "/home/bearingpoint/wk-devops/SonoffWebSockets/build/libs/SonoffWebSockets-722e26d.war", "-v"
   // args "deploy --force=true ${war.archivePath}"
}


//task runApp(type:JavaExec) {
//    classpath = sourceSets.main.runtimeClasspath
//
//    main = project.hasProperty("mainClass") ? project.getProperty("mainClass") : "package.MyDefaultMain"
//}